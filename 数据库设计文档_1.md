# 梦回宋朝 · 数据库设计文档

> 本文档基于《前端接口文档》与业务流程梳理，用于指导数据库设计与开发。  
> 项目：梦回宋朝（宋韵文化主题小程序）  
> 建议数据库：MySQL 5.7+ / 8.0，字符集 utf8mb4

---

## 一、设计原则

- **第三范式**：非主键字段仅依赖主键，减少冗余
- **命名规范**：表名、字段名小写 + 下划线，见名知意
- **扩展性**：预留扩展字段，高频查询适度冗余并注明
- **软删除**：核心业务表使用 `deleted_at` 支持软删（可选）

---

## 二、ER 关系概览

```
┌─────────────┐     ┌─────────────────┐     ┌──────────────┐
│   users     │────<│   cart_items    │>────│   products   │
└──────┬──────┘     └─────────────────┘     └──────┬───────┘
       │                                           │
       │  ┌─────────────────┐                      │
       ├─>│     orders      │<─────────────────────┤
       │  └────────┬────────┘                      │
       │           │                               │
       │  ┌────────┴────────┐             ┌───────┴────────┐
       │  │  order_items    │             │ product_images │
       │  └─────────────────┘             │ product_styles │
       │                                  └────────────────┘
       │
       │  ┌─────────────┐     ┌─────────────┐
       ├─>│   posts     │<───>│ user_follows│
       │  └──────┬──────┘     └─────────────┘
       │         │
       │  ┌──────┴──────┐     ┌─────────────┐     ┌─────────────┐
       ├─>│ collections │     │ post_likes  │     │  creations  │
       ├─>│   messages  │     └─────────────┘     └─────────────┘
       ├─>│   feedback  │     ┌─────────────┐
       └─>│   address   │     │  carousel   │  ┌─│   topics    │
          └─────────────┘     │   topics    │  │ └─────────────┘
                              └─────────────┘  │
                               ┌─────────────┐ │
                               │  logistics  │─┘
                               └─────────────┘
```

---

## 三、表结构定义

### 3.1 用户与认证

#### users（用户表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键，自增 |
| phone | VARCHAR(11) | N | - | 手机号，唯一 |
| nickname | VARCHAR(32) | N | - | 昵称，最多 16 字 |
| avatar | VARCHAR(512) | Y | NULL | 头像 URL |
| bio | VARCHAR(80) | Y | NULL | 签名，最多 40 字 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | 更新时间 |

- **主键**：`id`
- **唯一索引**：`uk_phone (phone)`
- **说明**：登录后创建/更新，phone 作为唯一标识

---

#### user_settings（用户设置表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键，自增 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| notify | TINYINT(1) | N | 1 | 消息通知：0 关 1 开 |
| sound | TINYINT(1) | N | 1 | 声音提示：0 关 1 开 |
| data_saver | TINYINT(1) | N | 0 | 节省流量：0 关 1 开 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **唯一索引**：`uk_user_id (user_id)` — 每用户一条
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

#### sms_codes（短信验证码表，可选）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| phone | VARCHAR(11) | N | - | 手机号 |
| code | VARCHAR(6) | N | - | 验证码 |
| expires_at | DATETIME | N | - | 过期时间 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **索引**：`idx_phone_expires (phone, expires_at)`
- **说明**：发送验证码时写入，校验后或过期可删除/定时清理

---

#### auth_tokens（登录 Token 表，可选）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| token | VARCHAR(128) | N | - | Token 字符串 |
| expires_at | DATETIME | N | - | 过期时间 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **唯一索引**：`uk_token (token)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE
- **说明**：若采用 JWT 无状态鉴权可省略此表

---

### 3.2 商品与集市

#### products（商品表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键，自增 |
| name | VARCHAR(128) | N | - | 商品名称 |
| subtitle | VARCHAR(128) | Y | NULL | 副标题 |
| description | VARCHAR(512) | Y | NULL | 描述 |
| main_img | VARCHAR(512) | Y | NULL | 主图 URL（冗余，便于列表展示） |
| price | DECIMAL(10,2) | N | 0 | 现价 |
| origin_price | DECIMAL(10,2) | Y | NULL | 原价 |
| tag | VARCHAR(16) | Y | NULL | 单品标签：新品/热卖/自营/精选 |
| sales_text | VARCHAR(32) | Y | NULL | 销量文案：已售800+ |
| shop_name | VARCHAR(64) | Y | NULL | 店铺名 |
| shipping_from | VARCHAR(64) | Y | NULL | 发货地 |
| service | VARCHAR(256) | Y | NULL | 服务说明 |
| type | VARCHAR(16) | N | 'normal' | 类型：new/series/normal |
| is_featured | TINYINT(1) | N | 0 | 是否推荐/热门：0 否 1 是 |
| is_carousel | TINYINT(1) | N | 0 | 是否轮播图：0 否 1 是 |
| sort_order | INT | N | 0 | 排序，数值越小越靠前 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **索引**：`idx_type (type)`、`idx_featured (is_featured)`、`idx_carousel (is_carousel)`、`idx_sort (sort_order)`
- **说明**：`main_img` 为冗余字段，减轻列表查询时关联 `product_images`

---

#### product_images（商品图片表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| product_id | BIGINT UNSIGNED | N | - | 商品 ID |
| url | VARCHAR(512) | N | - | 图片 URL |
| sort_order | INT | N | 0 | 排序 |

- **主键**：`id`
- **索引**：`idx_product_id (product_id)`
- **外键**：`product_id` → `products.id` ON DELETE CASCADE

---

#### product_styles（商品款式/规格表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| product_id | BIGINT UNSIGNED | N | - | 商品 ID |
| name | VARCHAR(64) | N | - | 款式名 |
| thumb | VARCHAR(512) | Y | NULL | 缩略图 URL |
| sort_order | INT | N | 0 | 排序 |

- **主键**：`id`
- **索引**：`idx_product_id (product_id)`
- **外键**：`product_id` → `products.id` ON DELETE CASCADE

---

#### product_tags（商品标签关联表，可选）

若商品标签固定且少，可在 `products` 表用 `tags` JSON 存储；若需单独维护标签则用本表。

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| product_id | BIGINT UNSIGNED | N | - | 商品 ID |
| tag | VARCHAR(32) | N | - | 标签：包邮/满减/换购等 |

- **索引**：`idx_product_id (product_id)`
- **说明**：也可用 `products.tags` JSON 字段简化，如 `["包邮","满减"]`

---

### 3.3 购物车

#### cart_items（购物车明细表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| product_id | BIGINT UNSIGNED | N | - | 商品 ID |
| style_id | BIGINT UNSIGNED | Y | NULL | 款式 ID |
| qty | INT UNSIGNED | N | 1 | 数量 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **唯一索引**：`uk_user_product_style (user_id, product_id, style_id)` — 同用户同商品同款式唯一
- **外键**：`user_id` → `users.id`，`product_id` → `products.id`，`style_id` → `product_styles.id`

---

### 3.4 地址与订单

#### addresses（收货地址表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| name | VARCHAR(32) | N | - | 收货人 |
| phone | VARCHAR(11) | N | - | 手机号 |
| province | VARCHAR(32) | N | - | 省 |
| city | VARCHAR(32) | N | - | 市 |
| district | VARCHAR(32) | Y | NULL | 区 |
| detail | VARCHAR(256) | N | - | 详细地址 |
| is_default | TINYINT(1) | N | 0 | 是否默认：0 否 1 是 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **索引**：`idx_user_id (user_id)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

#### orders（订单主表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| order_no | VARCHAR(32) | N | - | 订单号，唯一 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| address_id | BIGINT UNSIGNED | Y | NULL | 收货地址 ID |
| total_amount | DECIMAL(10,2) | N | 0 | 订单总金额 |
| status | VARCHAR(16) | N | 'pending' | 状态：pending/paid/shipped/finished/cancelled |
| remark | VARCHAR(256) | Y | NULL | 买家备注 |
| pay_type | VARCHAR(16) | Y | NULL | 支付方式：wechat/alipay |
| pay_at | DATETIME | Y | NULL | 支付时间 |
| ship_at | DATETIME | Y | NULL | 发货时间 |
| confirm_at | DATETIME | Y | NULL | 确认收货时间 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **唯一索引**：`uk_order_no (order_no)`
- **索引**：`idx_user_status (user_id, status)`、`idx_created (created_at)`
- **外键**：`user_id` → `users.id`，`address_id` → `addresses.id`

---

#### order_items（订单明细表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| order_id | BIGINT UNSIGNED | N | - | 订单 ID |
| product_id | BIGINT UNSIGNED | N | - | 商品 ID |
| style_id | BIGINT UNSIGNED | Y | NULL | 款式 ID |
| product_snapshot | JSON | Y | NULL | 下单时商品快照：name,img,price 等 |
| qty | INT UNSIGNED | N | 1 | 数量 |
| price | DECIMAL(10,2) | N | 0 | 单价 |
| subtotal | DECIMAL(10,2) | N | 0 | 小计 |

- **主键**：`id`
- **索引**：`idx_order_id (order_id)`
- **外键**：`order_id` → `orders.id` ON DELETE CASCADE
- **说明**：`product_snapshot` 保存下单瞬间商品信息，避免后续商品变更影响历史订单展示

---

#### logistics（物流信息表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| order_id | BIGINT UNSIGNED | N | - | 订单 ID |
| company | VARCHAR(64) | Y | NULL | 物流公司 |
| tracking_no | VARCHAR(64) | Y | NULL | 物流单号 |
| traces | JSON | Y | NULL | 轨迹：[{time,desc}] |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **唯一索引**：`uk_order_id (order_id)` — 一单一物流
- **外键**：`order_id` → `orders.id` ON DELETE CASCADE

---

### 3.5 发现与内容

#### carousel（轮播图表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| image | VARCHAR(512) | N | - | 图片 URL |
| title | VARCHAR(64) | Y | NULL | 标题 |
| link | VARCHAR(256) | Y | NULL | 跳转链接 |
| sort_order | INT | N | 0 | 排序 |

- **主键**：`id`
- **索引**：`idx_sort (sort_order)`

---

#### topics（话题表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| key | VARCHAR(32) | N | - | 话题键：life/clothing/food/overview |
| title | VARCHAR(64) | N | - | 标题：#生活在宋朝 |
| image | VARCHAR(512) | Y | NULL | 图片 URL |
| link | VARCHAR(256) | Y | NULL | 跳转路径 |
| sort_order | INT | N | 0 | 排序 |

- **主键**：`id`
- **唯一索引**：`uk_key (key)`

---

#### posts（帖子/动态表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 发布者 ID |
| topic | VARCHAR(64) | Y | NULL | 话题：#生活在宋朝 |
| content | VARCHAR(256) | N | - | 正文，最多 120 字 |
| likes_count | INT UNSIGNED | N | 0 | 点赞数（冗余，便于排序） |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **索引**：`idx_user_id (user_id)`、`idx_created (created_at)`、`idx_likes (likes_count)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

#### post_images（帖子图片表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| post_id | BIGINT UNSIGNED | N | - | 帖子 ID |
| url | VARCHAR(512) | N | - | 图片 URL |
| sort_order | INT | N | 0 | 排序 |

- **主键**：`id`
- **索引**：`idx_post_id (post_id)`
- **外键**：`post_id` → `posts.id` ON DELETE CASCADE

---

#### user_follows（关注关系表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| follower_id | BIGINT UNSIGNED | N | - | 关注者（我） |
| following_id | BIGINT UNSIGNED | N | - | 被关注者 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **唯一索引**：`uk_follow (follower_id, following_id)`
- **索引**：`idx_follower (follower_id)`、`idx_following (following_id)`
- **外键**：`follower_id`、`following_id` → `users.id` ON DELETE CASCADE
- **约束**：`follower_id != following_id`

---

#### post_likes（帖子点赞表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| post_id | BIGINT UNSIGNED | N | - | 帖子 ID |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **唯一索引**：`uk_post_user (post_id, user_id)` — 一人一点赞
- **外键**：`post_id` → `posts.id`，`user_id` → `users.id` ON DELETE CASCADE

---

### 3.6 收藏

#### collections（收藏表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| type | VARCHAR(16) | N | - | 类型：goods/notes |
| target_id | VARCHAR(64) | N | - | 目标 ID：商品 ID 或帖子 ID |
| extra | JSON | Y | NULL | 扩展：notes 时存 title、excerpt、from |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **唯一索引**：`uk_user_type_target (user_id, type, target_id)` — 同用户同类型同目标仅一条
- **索引**：`idx_user_type (user_id, type)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

### 3.7 创作

#### creations（创作表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 用户 ID |
| title | VARCHAR(64) | N | - | 标题 |
| type | VARCHAR(32) | N | - | 类型：服饰设计/饮食随笔/建筑手稿/出行见闻/其他 |
| content | TEXT | N | - | 正文，最多 400 字 |
| excerpt | VARCHAR(128) | Y | NULL | 摘要（前 50 字） |
| words | INT UNSIGNED | N | 0 | 字数 |
| mood | VARCHAR(32) | Y | NULL | 心情标签 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |
| updated_at | DATETIME | N | CURRENT_TIMESTAMP ON UPDATE | |

- **主键**：`id`
- **索引**：`idx_user_id (user_id)`、`idx_created (created_at)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

### 3.8 消息与反馈

#### messages（消息通知表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | N | - | 接收用户 ID |
| category | VARCHAR(16) | N | - | 分类：system/social/order |
| title | VARCHAR(128) | N | - | 标题 |
| preview | VARCHAR(256) | Y | NULL | 摘要 |
| content | TEXT | Y | NULL | 完整内容 |
| is_read | TINYINT(1) | N | 0 | 是否已读：0 否 1 是 |
| related_id | VARCHAR(64) | Y | NULL | 关联 ID：订单 ID 等 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **索引**：`idx_user_category (user_id, category)`、`idx_read (user_id, is_read)`
- **外键**：`user_id` → `users.id` ON DELETE CASCADE

---

#### private_messages（私信表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| sender_id | BIGINT UNSIGNED | N | - | 发送者 ID |
| receiver_id | BIGINT UNSIGNED | N | - | 接收者 ID |
| content | VARCHAR(512) | N | - | 内容 |
| is_read | TINYINT(1) | N | 0 | 是否已读 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **索引**：`idx_receiver (receiver_id)`、`idx_conversation (sender_id, receiver_id)`
- **外键**：`sender_id`、`receiver_id` → `users.id` ON DELETE CASCADE

---

#### feedback（意见反馈表）

| 字段 | 类型 | 空 | 默认 | 说明 |
|------|------|-----|------|------|
| id | BIGINT UNSIGNED | N | - | 主键 |
| user_id | BIGINT UNSIGNED | Y | NULL | 用户 ID（未登录可为空） |
| rate | TINYINT UNSIGNED | N | 5 | 评分 1–5 |
| tags | JSON | Y | NULL | 标签：["界面设计","交互体验"] |
| content | VARCHAR(600) | N | - | 描述，最多 300 字 |
| contact | VARCHAR(128) | Y | NULL | 联系方式 |
| created_at | DATETIME | N | CURRENT_TIMESTAMP | |

- **主键**：`id`
- **索引**：`idx_user_id (user_id)`、`idx_created (created_at)`
- **外键**：`user_id` → `users.id` ON DELETE SET NULL

---

## 四、设计说明

### 4.1 表与接口对应

| 接口模块 | 主要表 |
|----------|--------|
| 认证 | users, sms_codes, auth_tokens |
| 用户 | users, user_settings |
| 商品 | products, product_images, product_styles, product_tags |
| 购物车 | cart_items |
| 订单 | orders, order_items, addresses, logistics |
| 发现 | posts, post_images, post_likes, user_follows, carousel, topics |
| 收藏 | collections |
| 创作 | creations |
| 消息 | messages, private_messages |
| 反馈 | feedback |

### 4.2 冗余与性能

- **products.main_img**：列表只查主图，避免频繁 JOIN product_images
- **posts.likes_count**：按热度排序时可直接用，减少 COUNT(post_likes)
- **order_items.product_snapshot**：历史订单展示不受商品修改影响

### 4.3 可选扩展

- **product_tags**：标签简单可改 JSON；标签需独立管理则保留关联表
- **auth_tokens**：使用 JWT 无状态时可删除
- **sms_codes**：可用 Redis 替代，减少表写入
- **软删除**：orders、posts、creations 等可加 `deleted_at` 支持软删

### 4.4 枚举值汇总

| 表/字段 | 枚举值 |
|---------|--------|
| orders.status | pending, paid, shipped, finished, cancelled |
| creations.type | 服饰设计, 饮食随笔, 建筑手稿, 出行见闻, 其他 |
| messages.category | system, social, order |
| collections.type | goods, notes |
| products.type | new, series, normal |

---

## 五、建表脚本示例（MySQL）

```sql
-- 字符集
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- 用户表
CREATE TABLE `users` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `phone` VARCHAR(11) NOT NULL,
  `nickname` VARCHAR(32) NOT NULL,
  `avatar` VARCHAR(512) DEFAULT NULL,
  `bio` VARCHAR(80) DEFAULT NULL,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 用户设置
CREATE TABLE `user_settings` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` BIGINT UNSIGNED NOT NULL,
  `notify` TINYINT(1) NOT NULL DEFAULT 1,
  `sound` TINYINT(1) NOT NULL DEFAULT 1,
  `data_saver` TINYINT(1) NOT NULL DEFAULT 0,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  CONSTRAINT `fk_settings_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 商品表
CREATE TABLE `products` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(128) NOT NULL,
  `subtitle` VARCHAR(128) DEFAULT NULL,
  `description` VARCHAR(512) DEFAULT NULL,
  `main_img` VARCHAR(512) DEFAULT NULL,
  `price` DECIMAL(10,2) NOT NULL DEFAULT 0,
  `origin_price` DECIMAL(10,2) DEFAULT NULL,
  `tag` VARCHAR(16) DEFAULT NULL,
  `sales_text` VARCHAR(32) DEFAULT NULL,
  `shop_name` VARCHAR(64) DEFAULT NULL,
  `shipping_from` VARCHAR(64) DEFAULT NULL,
  `service` VARCHAR(256) DEFAULT NULL,
  `type` VARCHAR(16) NOT NULL DEFAULT 'normal',
  `is_featured` TINYINT(1) NOT NULL DEFAULT 0,
  `is_carousel` TINYINT(1) NOT NULL DEFAULT 0,
  `sort_order` INT NOT NULL DEFAULT 0,
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_type` (`type`),
  KEY `idx_featured` (`is_featured`),
  KEY `idx_sort` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 其余表可参照上表结构逐一定义，此处略。
-- 建议使用迁移工具（如 knex、TypeORM、Sequelize）管理 DDL。

SET FOREIGN_KEY_CHECKS = 1;
```

---

## 六、版本记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2026-02-04 | 初版，基于《前端接口文档》与业务流程整理 |

---

> 文档结束。实施时可根据实际 ORM、迁移工具及部署环境调整字段类型与约束。
